% 
% MODULE : modem
%

\section{modem}
\label{module:modem}
The modem module implements a set of (mod)ulation/(dem)odulation schemes
for encoding information into signals.
%For the analog modems, samples are modulated according to...
For the digital modems, data bits are encoded into symbols representing
carrier frequency, phase, amplitude, etc.

\subsection{Analog modulation schemes}
freqmod, ampmod, etc.

\subsection{Continuous phase digital modulation schemes}
fsk, msk, etc. [NOTE: not yet implemented]

\subsection{Linear digital modulation schemes}
(d)psk, apsk, ask, qam

The {\tt modem} object realizes the linear digital modulation library in which
the information from a symbol is encoded into the amplitude and phase of a
sample.
The input/output relationship for modulation/demodulation for {\tt modem} is
strictly one-to-one and is independent of any pulse shaping, or interpolation.
This differs from {\tt cpmodem} in which the pulse shaping filter is
integrated into the modem itself.

\subsubsection{Usage}
\begin{itemize}
\item[] {\tt modem\_modulate()} converts an input symbol into an output sample
\item[] {\tt modem\_demodulate()} finds the closest symbol which matches the
input sample
\item[] {\tt modem\_get\_demodulator\_phase\_error()} returns an angle
proportional to the phase error after demodulation
\item[] {\tt modem\_get\_demodulator\_evm()} returns a value equal to the
error vector magnitude after demodulation
\end{itemize}

\subsubsection{Gray coding}
To reduce the bit error rate, all symbols are automatically Gray encoded;
adjacent symbols in a constellation differ by only one bit.
Gray encoding is computed to the binary-coded decimal symbol
by applying and exclusive OR bitmask of itself shifted to the right by a
single bit.
%
For example, the bcd value of 183 is {\tt 10110111}.
It has adjacent symbol 184 ({\tt 10111000}) which differs by 4 bits.
%
For example, the bcd value of 183 is {\tt 10110111}.
It has adjacent symbols 182 ({\tt 10110110}) which differs by only one bit,
and 184 ({\tt 10111000}) which differs by 4 bits.
\begin{verbatim}
        10110111    bcd_in (183)        10111000    bcd_in (184)
        .1011011    bcd_in >> 1         .1011100    bcd_in >> 1
xor :   --------                        --------
        11101100    gray_out (236)      11100100    gray_out (228)
\end{verbatim}
Notice that the two output symbols
236 ({\tt 11101100}) and
228 ({\tt 11100100}) differ by only one bit.
The decoding process is similar to encoding but slightly more involved.
Gray decoding is computed on an encoded input symbol
by adding to it (modulo 2) as many shifted versions of itself as it has bits.
\begin{verbatim}
        11101100    gray_in (236)       11100100    gray_in (228)
        .1110110    gray_in >> 1        .1110010    gray_in >> 1
        ..111011    gray_in >> 2        ..111001    gray_in >> 2
        ...11101    gray_in >> 3        ...11100    gray_in >> 3
        ....1110    gray_in >> 4        ....1110    gray_in >> 4
        .....111    gray_in >> 5        .....111    gray_in >> 5
        ......11    gray_in >> 6        ......11    gray_in >> 6
        .......1    gray_in >> 7        .......1    gray_in >> 7
xor :   --------                        --------
        10110111    gray_out (183)      10111000    gray_out (184)
\end{verbatim}
There are a few interesting characteristics of Gray encoding:
\begin{itemize}
\item the first bit never changes in encoding/decoding
\item there is a unique mapping between input and output symbols
\end{itemize}
It is also interesting to note that in linear modems (e.g. PSK), the
{\tt decoder} is applied to the symbol at the transmitter while the
{\tt encoder} is applied to the received symbol at the receiver.
This is somewhat counterintuitive and is because...
In \liquid, Gray encoding and decoding are computed with the
{\tt gray\_encode()} {\tt gray\_decode()} methods, respectively.

\subsubsection{{\tt MOD\_PSK} (phase-shift keying)}
demodulation is performed independent of the signal amplitude

\subsubsection{{\tt MOD\_DPSK} (differential phase-shift keying)}
demodulation is performed independent of the signal amplitude

\subsubsection{{\tt MOD\_APSK} (amplitude/phase-shift keying}

\subsubsection{{\tt MOD\_ASK} (amplitude-shift keying)}

\subsubsection{{\tt MOD\_QAM} (quadrature amplitude modulation)}
Also known as quadrature amplitude-shift keying
\begin{itemize}
\item I/Q symbols are decoded as separate {\tt MOD\_ASK} symbols
\item gray encoding is applied to I/Q symbols separately to help ensure
minimal bit changes between adjacent samples across both in-phase and
quadrature-phase dimensions
\end{itemize}

%-------------------- FIGURE: PSK MODEM --------------------
\begin{figure}[ht]
\centering
\mbox{
  \subfigure[BPSK]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_bpsk}
      \label{fig:modem:psk:2}
    } \quad
  \subfigure[QPSK]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_qpsk}
      \label{fig:modem:psk:4}
    } \quad
}
\mbox{
  \subfigure[8-PSK]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_8psk}
      \label{fig:modem:psk:8}
    } \quad
  \subfigure[16-PSK]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_16psk}
      \label{fig:modem:psk:16}
    } \quad
}
% trim = left bottom right top
\caption{Phase-shift keying (PSK) modem}
\label{fig:modem:psk}
\end{figure}


%-------------------- FIGURE: APSK MODEM --------------------
\begin{figure}[ht]
\centering
\mbox{
  \subfigure[4-APSK (1,3)]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_4apsk}
      \label{fig:modem:apsk:4}
    } \quad
  \subfigure[8-PSK (1,7)]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_8apsk}
      \label{fig:modem:apsk:8}
    } \quad
}
\mbox{
  \subfigure[16-APSK (4,12)]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_16apsk}
      \label{fig:modem:apsk:16}
    } \quad
  \subfigure[32-APSK (4,12,16)]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_32apsk}
      \label{fig:modem:apsk:32}
    } \quad
}
\mbox{
  \subfigure[64-APSK (4,14,20,26)]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_64apsk}
      \label{fig:modem:apsk:64}
    } \quad
  \subfigure[128-APSK (8,18,24,36,42)]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_128apsk}
      \label{fig:modem:apsk:128}
    } \quad
}
% trim = left bottom right top
\caption{Amplitude/phase-shift keying (APSK) modem}
\label{fig:modem:apsk}
\end{figure}


%-------------------- FIGURE: ASK MODEM --------------------
\begin{figure}[ht]
\centering
\mbox{
  \subfigure[2-ASK]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_2ask}
      \label{fig:modem:ask:2}
    } \quad
  \subfigure[4-ASK]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_4ask}
      \label{fig:modem:ask:4}
    } \quad
}
\mbox{
  \subfigure[8-ASK]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_8ask}
      \label{fig:modem:ask:8}
    } \quad
  \subfigure[16-ASK]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_16ask}
      \label{fig:modem:ask:16}
    } \quad
}
% trim = left bottom right top
\caption{Pulse-amplitude modulation (ASK) modem}
\label{fig:modem:ask}
\end{figure}


%-------------------- FIGURE: QAM MODEM --------------------
\begin{figure}[ht]
\centering
\mbox{
  \subfigure[8-QAM]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_8qam}
      \label{fig:modem:qam:8}
    } \quad
  \subfigure[16-QAM]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_16qam}
      \label{fig:modem:qam:16}
    } \quad
}
\mbox{
  \subfigure[32-QAM]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_32qam}
      \label{fig:modem:qam:32}
    } \quad
  \subfigure[64-QAM]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_64qam}
      \label{fig:modem:qam:64}
    } \quad
}
\mbox{
  \subfigure[128-QAM]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_128qam}
      \label{fig:modem:qam:128}
    } \quad
  \subfigure[256-QAM]
    {
      \includegraphics[trim = 15mm 0mm 15mm 0mm, clip, height=6cm]{figures.gen/modem_256qam}
      \label{fig:modem:qam:256}
    } \quad
}
% trim = left bottom right top
\caption{Rectangular quaternary-amplitude modulation (QAM) modem}
\label{fig:modem:qam}
\end{figure}


