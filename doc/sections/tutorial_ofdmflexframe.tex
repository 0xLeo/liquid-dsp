% 
% TUTORIAL : ofdmflexframe
%

\newpage
\section{Tutorial: OFDM Framing}
\label{tutorial:ofdmflexframe}

In the previous tutorials we have created only the basic building blocks
for wireless communication.
We have also used the basic {\tt framegen64} and {\tt framesync64}
objects to transmit and receive simple framing data.
This tutorial extends...


%
% SUBSECTION : problem statement
%
\subsection{Problem Statement}
\label{tutorial:ofdmflexframe:problem}
% talking points:
%   * what is OFDM (briefly)
%   * the benefits of OFDM (briefly)
%   * current standards using OFDM



%
% SUBSECTION : 
%
\subsection{Setting up the Environment}
\label{tutorial:ofdmflexframe:environment}

As with the other tutorials I assume that you are using {\tt gcc} to
compile your programs and link to appripriate libraries.
Create a new file {\tt ofdmflexframe.c} and include the headers
{\tt stdio.h},
{\tt stdlib.h},
{\tt math.h},
{\tt complex.h}, and
{\tt liquid/liquid.h}.
Add the {\tt int main()} definition so that your program looks like
this:
%
\input{tutorials/ofdmflexframe_init_tutorial.c.tex}
%
Compile and link the program using {\tt gcc}:
%
\begin{Verbatim}[fontsize=\small]
    $ gcc -Wall -o ofdmflexframe -lm -lc -lliquid ofdmflexframe.c
\end{Verbatim}
%
The flag ``{\tt -Wall}'' tells the compiler to print all warnings
(unused and uninitialized variables, etc.),
``{\tt -o ofdmflexframe}'' specifies the name of the output program is
``{\tt ofdmflexframe}'', and
``{\tt -lm -lc -lliquid}'' tells the linker to link the binary against
the math, standard C, and \liquid\ DSP libraries, respectively.
Notice that the above command invokes both the compiler and the linker
collectively.
%While it is usually preferred to build an intermediate object...
%
If the compiler did not give any errors, the output executable
{\tt ofdmflexframe} is created which can be run as
%
\begin{Verbatim}[fontsize=\small]
    $ ./ofdmflexframe
\end{Verbatim}
%
and should simply print ``{\tt done.}'' to the screen.
You are now ready to add functionality to your program.



%
% SUBSECTION : framing structure
%
\subsection{OFDM Framing Structure}
\label{tutorial:ofdmflexframe:structure}
%
The OFDM framing stucture is described briefly here
(for a more detailed description, see
Section~\ref{module:framing:ofdmflexframe}).
The {\tt ofdmflexframe} generator and synchronizer objects
together realize a simple framing structure
for loading data onto a reconfigurable OFDM physical layer.
The generator encapsulates a xxx-byte user-defined header
and a variable-length buffer of uncoded payload data
and fully encodes a frame of OFDM symbols ready for transmission.
The user may define many physical-layer parameters of the transmission,
including
  the number of subcarriers and their allocation (null/pilot/data),
  cyclic prefix length,
  forward error-correction coding,
  modulation scheme,
  and others.
The synchronizer...

%
% SUBSECTION : frame generator
%
\subsection{Creating the Frame Generator}
\label{tutorial:ofdmflexframe:framegen}
%
The {\tt ofdmflexframegen} object can be generated with the
{\tt ofdmflexframegen\_create(M,c,p,props)} method which accepts four arguments:
%
\begin{itemize}
\item[$M$] is an {\tt unsigned int} representing the total number of
    subcarriers
\item[$c$] is an {\tt unsigned int} representing the length of the
    cyclic prefix
\item[$\vec{p}$] is an $M$-element array of {\tt unsigned char} which
    gives the subcarrier allocation (e.g. which subcarriers
    are nulled/disabled, which are pilots, and which carry data).
    Setting to {\tt NULL} tells the {\tt ofdmflexframegen} object to use
    the default subcarrier allocation
\item[{\tt props}] is a special structure called
    {\tt ofdmflexframegenprops\_s}
    which gives some basic properties including
    the length of the payload ({\tt payload\_len}),
    the forward error-correction scheme(s) to use ({\tt fec0},
    {\tt fec1}),
    and the modulation scheme ({\tt mod\_scheme}) and depth
    ({\tt mod\_depth}).
    The properties object can be initialized to its default by using
    {\tt ofdmflexframegenprops\_init\_default()}.
\end{itemize}
%
To begin, create a frame generator having 64 subcarriers with cyclic
prefix of 16 samples, the default subcarrier allocation, and
a payload of 120 bytes (but otherwise default properties) as
%
\begin{Verbatim}[fontsize=\small]
    ofdmflexframegenprops_s fgprops;                // create properties object
    ofdmflexframegenprops_init_default(&fgprops);   // initialize to default
    fgprops.payload_len = 120;                      // set payload length

    // create frame generator
    ofdmflexframegen fg = ofdmflexframegen_create(64, 16, NULL, &fgprops);
\end{Verbatim}
%
As with all structures in \liquid\ you will need to invoke the
corresponding {\tt destroy()} method when you are finished with the
object.
%
\input{tutorials/ofdmflexframe_basic_tutorial.c.tex}
%
Running the program should produce an output similar to this:
%
\begin{Verbatim}[fontsize=\small]
ofdmflexframegen:
    num subcarriers     :   64
      * NULL            :   12
      * pilot           :   6
      * data            :   46
    cyclic prefix len   :   16
    properties:
      * mod scheme      :   quaternary phase-shift keying (2 b/s)
      * fec (inner)     :   none
      * fec (outer)     :   none
      * CRC scheme      :   CRC (16-bit)
    payload:
      * decoded bytes   :   120
      * encoded bytes   :   122
      * modulated syms  :   488
    total OFDM symbols  :   18
      * S0 symbols      :   3 @ 64
      * S1 symbols      :   1 @ 80
      * header symbols  :   3 @ 80
      * payload symbols :   11 @ 80
    spectral efficiency :   0.6897 b/s/Hz
done.
\end{Verbatim}
%
Notice that the {\tt ofdmflexframegen\_print()} method gives a lot of
information, including
the number of null, pilot, and data subcarriers,
the number of modulated symbols,
the number of OFDM symbols,
and the resulting spectral efficiency.

%
% SUBSECTION : frame synchronizer
%
\subsection{Creating the Frame Synchronizer}
\label{tutorial:ofdmflexframe:framesync}
The OFDM frame synchronizer...

%
% SUBSECTION : 
%
\subsection{Putting it All Together}
\label{tutorial:ofdmflexframe:xxx}

%
% SUBSECTION : 
%
\subsection{Final Program}
\label{tutorial:ofdmflexframe:completed}

%
\input{tutorials/ofdmflexframe_tutorial.c.tex}
%
Running the program should produce an output similar to this:
%
\begin{Verbatim}[fontsize=\small]
ofdmflexframegen:
    num subcarriers     :   64
      * NULL            :   12
      * pilot           :   6
      * data            :   46
    cyclic prefix len   :   16
    properties:
      * mod scheme      :   quaternary phase-shift keying (2 b/s)
      * fec (inner)     :   none
      * fec (outer)     :   Hamming(12,8)
      * CRC scheme      :   CRC (32-bit)
    payload:
      * decoded bytes   :   120
      * encoded bytes   :   186
      * modulated syms  :   744
    total OFDM symbols  :   24
      * S0 symbols      :   3 @ 64
      * S1 symbols      :   1 @ 80
      * header symbols  :   3 @ 80
      * payload symbols :   17 @ 80
    spectral efficiency :   0.5128 b/s/Hz
***** callback invoked!
  header (valid)
  payload (valid)
done.
\end{Verbatim}
%
